@startuml
!define C4P https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master
!includeurl C4P/C4_Container.puml

title Gestión CSC - C2 Diagrama de Contenedores (v1.0.0)

Person(cliente, "Cliente", "Dueño del proyecto de construcción")
Person(usuario, "Usuario", "Proveedor/Contratista")
Person(admin, "Administrador", "Gestiona usuarios, accesos y configuración del sistema")

System_Boundary(gestionCSC, "Gestión CSC") {

    Container(webAppOwner, "App Web Cliente", "Angular","Interfaz web para los dueños del proyecto")

    Container(webAppBusiness, "App Web Empresa", "Angular","Interfaz web para los contratistas y proveedores")

    Container(webAppAdmin, "App Web Administrador", "Angular","Interfaz web para los administradores del sistema")

    Container(apiGateway, "API Gateway", "Spring Cloud Gateway","Punto de entrada único a los servicios")

    Container(msIdentidad, "ms-identidad", "Spring Boot","Autenticación, autorización y gestión de usuarios")

    Container(msEmpresa, "ms-empresa", "Spring Boot","Gestión de los procesos y estados de las empresas involucradas en el proyecto")

    Container(msMaterial, "ms-material", "Spring Boot","Gestión del flujo de materiales y recursos")

    Container(msFinanza, "ms-finanza", "Spring Boot","Gestión del flujo financiero y pagos")

    ContainerDb(dbIdentidad, "DB Identidad", "PostgreSQL","Usuarios, roles y credenciales")
    ContainerDb(dbEmpresa, "DB Empresa", "PostgreSQL","Empresas, contratos y estados del proyecto")
    ContainerDb(dbMaterial, "DB Material", "PostgreSQL","Inventario, órdenes y logística de materiales")
    ContainerDb(dbFinanzas, "DB Finanzas", "PostgreSQL","Pagos, facturación y transacciones financieras")


}

System_Ext(notifProvider, "Servicio de Notificaciones", "SMS, Push, Email, WhatsApp")
System_Ext(paymentGateway, "Pasarela de Pagos", "Procesamiento de pagos")
System_Ext(transportProvider, "Proveedor de Transporte", "Transporte de materiales y equipos de construcción")

' Relaciones usuarios
Rel(cliente, webAppOwner, "Usa")
Rel(usuario, webAppBusiness, "Usa")
Rel(admin, webAppAdmin, "Administra")

' Web → Gateway
Rel(webAppOwner, apiGateway, "Consume API REST", "HTTPS/JSON")
Rel(webAppBusiness, apiGateway, "Consume API REST", "HTTPS/JSON")
Rel(webAppAdmin, apiGateway, "Consume API REST", "HTTPS/JSON")

' Gateway → Microservicios
Rel(apiGateway, msIdentidad, "Autentica y autoriza solicitudes")
Rel(apiGateway, msEmpresa, "Rutea")
Rel(apiGateway, msMaterial, "Rutea")
Rel(apiGateway, msFinanza, "Rutea")

' Microservicios → DB
Rel(msIdentidad, dbIdentidad, "Lee/Escribe")
Rel(msEmpresa, dbEmpresa, "Lee/Escribe")
Rel(msMaterial, dbMaterial, "Lee/Escribe")
Rel(msFinanza, dbFinanzas, "Lee/Escribe")

' Integraciones externas
Rel(msIdentidad, notifProvider, "Envía notificaciones")
Rel(msMaterial, notifProvider, "Envía notificaciones")
Rel(msFinanza, paymentGateway, "Procesa pagos")
Rel(msMaterial, transportProvider, "Solicita transporte")

SHOW_LEGEND()
@enduml